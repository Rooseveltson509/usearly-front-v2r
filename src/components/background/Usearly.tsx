import { useEffect, useRef, useState } from "react";
import "./UsearlyDraw.scss";

type UsearlyDrawProps = {
  /** Durée de l'anim, accepte "40s", "1500ms" ou un nombre en secondes */
  animationDuration?: string | number;
};

export default function UsearlyDraw({
  animationDuration = "45s",
}: UsearlyDrawProps) {
  const wrapRef = useRef<HTMLDivElement | null>(null);
  const [isVisible, setIsVisible] = useState(false);

  // Normalise la durée : ajoute "s" si un nombre (ou une string sans unité) est fourni
  const resolvedDuration = (() => {
    if (typeof animationDuration === "number") return `${animationDuration}s`;
    if (/^\d+(\.\d+)?$/.test(animationDuration)) return `${animationDuration}s`;
    return animationDuration;
  })();

  useEffect(() => {
    const target = wrapRef.current;
    if (!target) return;

    const observer = new IntersectionObserver(
      (entries) => {
        const [entry] = entries;
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.disconnect();
        }
      },
      { threshold: 0.2 },
    );

    observer.observe(target);
    return () => observer.disconnect();
  }, []);

  return (
    <div
      ref={wrapRef}
      className="usearly-wrap"
      style={{ ["--usearly-duration" as const]: resolvedDuration }}
    >
      <svg
        className="usearly-svg"
        viewBox="0 0 1385 407"
        aria-labelledby="usearlyTitle"
        role="img"
      >
        <title id="usearlyTitle">Usearly</title>
        <path
          className={`usearly-path ${isVisible ? "animate" : ""}`}
          pathLength="1"
          d="M1227.57 100.119L1227.68 100.467L1271.37 236.652L1271.38 236.66C1272.68 240.97 1274.43 248.917 1276.62 260.478C1277.7 253.72 1279.66 245.91 1282.48 237.049L1282.48 237.044L1327.56 100.463L1327.67 100.119H1383.73L1383.47 100.798L1295.88 330.08C1286.18 355.492 1274.11 374.596 1259.66 387.351C1245.21 400.114 1228.38 406.5 1209.21 406.5C1196 406.5 1184.8 404.981 1175.64 401.929L1175.3 401.814V355.752L1176.03 356.145C1183.87 360.321 1192.35 362.411 1201.5 362.411C1209.65 362.411 1216.61 360.327 1222.42 356.179C1228.22 352.028 1232.9 345.786 1236.43 337.416L1236.43 337.414L1249 307.956L1165.65 100.806L1165.37 100.119H1227.57ZM58.0449 16.9053V188.379C58.0449 213.691 63.1111 232.584 73.1592 245.141C83.1902 257.676 98.2524 263.978 118.44 263.978C138.235 263.978 153.002 257.888 162.834 245.78C172.683 233.652 177.649 215.404 177.649 190.949V16.9053H234.997V184.821C234.997 227.781 225.063 260.094 205.108 281.667C185.147 303.248 155.236 313.996 115.475 313.996C77.2274 313.996 48.4536 303.544 29.25 282.555C10.0541 261.574 0.5 230.151 0.5 188.379V16.9053H58.0449ZM570.408 95.1777C599.515 95.1778 622.266 104.111 638.592 122.024C654.91 139.93 663.041 164.507 663.041 195.692V220.505H524.285C525.477 237.807 530.996 250.731 540.785 259.358C550.679 268.079 565.01 272.477 583.853 272.477C606.826 272.476 627.289 266.441 645.259 254.377L646.038 253.854V296.983L645.789 297.128C626.446 308.386 601.638 313.996 571.396 313.996C539.003 313.996 513.684 304.608 495.511 285.776L495.51 285.774C477.471 266.945 468.482 240.65 468.482 206.959C468.482 173.912 478.137 147.033 497.482 126.368C516.955 105.576 541.276 95.1777 570.408 95.1777ZM785.715 95.1777C813.869 95.1777 835.075 102.314 849.239 116.674C863.402 131.032 870.439 152.528 870.439 181.065V308.857H816.849V278.221H816.645C802.585 302.058 781.711 313.996 754.081 313.996C733.95 313.996 717.933 308.366 706.088 297.057L706.086 297.055C694.242 285.613 688.337 270.321 688.337 251.234C688.337 231.297 694.27 215.493 706.183 203.883C717.712 192.646 734.789 185.391 757.351 182.065L759.551 181.756L817.043 173.909C816.973 160.96 813.765 151.32 807.501 144.897C801.169 138.405 791.632 135.116 778.795 135.116C754.259 135.116 731.161 142.788 709.49 158.15L708.701 158.71V113.573L708.951 113.43C718.368 107.993 730.546 103.63 745.472 100.329C760.391 96.8975 773.807 95.1778 785.715 95.1777ZM1138.14 0.5V308.857H1082.18V0.5H1138.14ZM776.289 213.978H776.288C764.478 215.486 755.694 218.873 749.867 224.083C744.058 229.278 741.137 236.332 741.137 245.305C741.137 253.344 743.919 259.86 749.475 264.897C755.028 269.933 762.542 272.477 772.073 272.477C785.122 272.476 795.861 267.917 804.329 258.8C812.801 249.547 817.047 237.946 817.047 223.958V208.713L776.289 213.978ZM569.814 134.919C558.63 134.919 548.738 139.332 540.123 148.204C531.751 156.96 526.479 168.659 524.327 183.333H610.04C609.972 167.169 606.59 155.117 599.975 147.091C593.306 139 583.285 134.919 569.814 134.919ZM429.742 149.924L428.987 149.476C412.854 139.903 395.214 135.116 376.058 135.116C365.966 135.116 357.894 137.017 351.804 140.774C345.73 144.521 342.749 149.446 342.749 155.568C342.749 165.317 350.569 173.244 366.726 179.23L368.315 179.804L368.319 179.805C387.959 186.921 402.417 192.926 411.676 197.817C420.978 202.6 428.233 209.184 433.424 217.567C438.62 225.959 441.209 235.804 441.209 247.083C441.209 268.325 432.697 284.822 415.686 296.515C398.838 308.185 376.585 313.996 348.972 313.996C325.721 313.996 305.223 310.298 287.488 302.889L287.181 302.761V254.085L287.947 254.566C308.446 267.441 328.654 273.86 348.576 273.86C361.462 273.86 371.047 272.034 377.394 268.44C383.698 264.871 386.827 259.55 386.827 252.42C386.827 247.538 384.377 242.989 379.345 238.77C374.305 234.543 366.709 230.681 356.521 227.198V227.197C341.613 222.186 329.412 217.219 319.925 212.295C310.444 207.374 303.638 202.479 299.556 197.595L299.554 197.592C291.426 187.734 287.379 175.163 287.379 159.917C287.379 139.725 295.63 123.889 312.11 112.463C328.559 100.926 349.69 95.1777 375.465 95.1777C393.444 95.1778 411.421 98.0194 429.393 103.7L429.742 103.811V149.924ZM1052.14 152.3L1051.38 151.846C1044.22 147.554 1035.42 145.395 1024.95 145.395C1011.27 145.395 1000.34 150.982 992.133 162.188L992.132 162.19C983.911 173.279 979.774 188.25 979.774 207.156V308.857H923.612V100.119H979.774V139.318C984.844 125.29 991.864 114.684 1000.86 107.541C1010.09 100.214 1021.35 96.5616 1034.63 96.5615C1042.17 96.5615 1047.93 97.4843 1051.85 99.3779L1052.14 99.5146V152.3Z"
        />
      </svg>
    </div>
  );
}
